<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title>Yeast genome annotation lab (solutions)</title>
  <meta name="description" content="">

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">

  <!-- Tell iOS to run as an app if launched from home screen -->
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/page.css">
  <link rel="stylesheet" href="css/code.css">
  <link rel="stylesheet" href="css/print.css">

  <!-- All JavaScript at the bottom, except this Modernizr build. -->
  <script src="js/vendor/modernizr-2.5.3.min.js" type="text/javascript"></script>
</head>

<body>
  <!-- Prompt IE 6 users to install Chrome Frame. -->
  <!--[if lt IE 9]>
    <p class=chromeframe>
      Your web browser is <em>ancient!</em> <a href="http://browsehappy.com/">You should upgrade to a new browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.
    </p>
  <![endif]-->

  <!-- courseR content will be injected here -->
  <div id = "courser-stuff" class = "pageView">
<section>  <h1>Lab:  Explorying Genomes Solutions</h1>

<p>Below are solutions to the function implementations described in the exploring genomes lab.</p>

<section><h2>Refine your transcribe function</h2>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Transcibes DNA sequence into RNA equivalent</span>
<span class="comment">#</span>
<span class="comment"># dna   A character string containing DNA sequence</span>
<span class="comment">#</span>
<span class="comment"># value A character string containing RNA sequence</span>
<span class="comment">#</span>
<span class="symbol">transcribe</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">dna</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Replace all T&rsquo;s with U&rsquo;s</span>
  <span class="functioncall">gsub</span><span class="keyword">(</span> <span class="argument">pattern</span>     <span class="argument">=</span> <span class="string">&ldquo;T&rdquo;</span><span class="keyword">,</span>
        <span class="argument">replacement</span> <span class="argument">=</span> <span class="string">&ldquo;U&rdquo;</span><span class="keyword">,</span>
        <span class="argument">x</span>           <span class="argument">=</span> <span class="symbol">dna</span><span class="keyword">,</span>
        <span class="argument">fixed</span>       <span class="argument">=</span> <span class="number">TRUE</span>
        <span class="keyword">)</span>

<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="functioncall">transcribe</span><span class="keyword">(</span><span class="string">&ldquo;ATGCTTATCTA&rdquo;</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "AUGCUUAUCUA"</pre></div></div></div>
</section>
<section><h2>Refine your translate function</h2>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Translates RNA sequence into amino acid sequence</span>
<span class="comment">#</span>
<span class="comment"># rna   A character string containing RNA sequence</span>
<span class="comment">#</span>
<span class="comment"># value A character string containing amino sequence</span>
<span class="comment">#</span>
<span class="symbol">translate</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">rna</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Read a table with codons as the first column and amino acids as the second</span>
  <span class="symbol">translationTable</span> <span class="assignement">&lt;-</span> <span class="functioncall">read.delim</span><span class="keyword">(</span><span class="string">&ldquo;translationTable.txt&rdquo;</span><span class="keyword">,</span>
                                  <span class="argument">stringsAsFactors</span> <span class="argument">=</span> <span class="number">FALSE</span><span class="keyword">)</span>

  <span class="comment">#Takes a 3-letter codon and returns the matching 1-letter amino acid</span>
  <span class="symbol">translateCodon</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">codon</span><span class="keyword">)</span> <span class="keyword">{</span>
    <span class="symbol">translationTable</span><span class="keyword">[</span><span class="symbol">codon</span><span class="keyword">,</span><span class="keyword">]</span>
  <span class="keyword">}</span>

  <span class="comment">#Takes a codon number (n) in rna and returns the 3-letter sequence</span>
  <span class="symbol">getCodon</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">n</span><span class="keyword">)</span> <span class="keyword">{</span>
    <span class="functioncall">substr</span><span class="keyword">(</span><span class="symbol">rna</span><span class="keyword">,</span>
           <span class="argument">start</span>  <span class="argument">=</span> <span class="keyword">(</span><span class="symbol">n</span> <span class="keyword">*</span> <span class="number">3</span><span class="keyword">)</span> <span class="keyword">-</span> <span class="number">2</span><span class="keyword">,</span>
           <span class="argument">stop</span>   <span class="argument">=</span> <span class="symbol">n</span> <span class="keyword">*</span> <span class="number">3</span>
           <span class="keyword">)</span>
  <span class="keyword">}</span>


  <span class="comment">#A series of codon numbers 1..n</span>
  <span class="symbol">codonNumbers</span> <span class="assignement">&lt;-</span> <span class="number">1</span><span class="keyword">:</span><span class="keyword">(</span><span class="functioncall">nchar</span><span class="keyword">(</span><span class="symbol">rna</span><span class="keyword">)</span> <span class="keyword">/</span> <span class="number">3</span><span class="keyword">)</span>

  <span class="comment">#Character vector containing the sequence of amino acids in rna</span>
  <span class="symbol">aminoAcids</span> <span class="assignement">&lt;-</span> <span class="functioncall">sapply</span><span class="keyword">(</span><span class="symbol">codonNumbers</span><span class="keyword">,</span>
                       <span class="argument">FUN</span> <span class="argument">=</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">n</span><span class="keyword">)</span> <span class="keyword">{</span>
                          <span class="functioncall">translateCodon</span><span class="keyword">(</span><span class="functioncall">getCodon</span><span class="keyword">(</span><span class="symbol">n</span><span class="keyword">)</span><span class="keyword">)</span>
                      <span class="keyword">}</span><span class="keyword">)</span>

  <span class="comment">#Return a single string by joining the elements in aminoAcids</span>
  <span class="functioncall">return</span><span class="keyword">(</span> <span class="functioncall">paste</span><span class="keyword">(</span><span class="symbol">aminoAcids</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">&ldquo;&rdquo;</span><span class="keyword">,</span> <span class="argument">sep</span> <span class="argument">=</span> <span class="string">&ldquo;&rdquo;</span><span class="keyword">)</span> <span class="keyword">)</span>

<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="functioncall">translate</span><span class="keyword">(</span><span class="string">&ldquo;AUG&rdquo;</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "M"</pre></div><div class="source"><span class="functioncall">translate</span><span class="keyword">(</span><span class="string">&ldquo;UUCUAAAUUAACAAAAUC&rdquo;</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "FXINKI"</pre></div><div class="source"><span class="functioncall">translate</span><span class="keyword">(</span><span class="string">&ldquo;UUCUAAAUUAACAAAAU&rdquo;</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "FXINK"</pre></div><div class="source"><span class="functioncall">translate</span><span class="keyword">(</span><span class="string">&ldquo;UUCUAAAUUAACAAAA&rdquo;</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "FXINK"</pre></div></div></div>
</section>
<section><h2>ORF finder</h2>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Returns a data.frame describing the ORFs found in the given aminoacid sequence</span>
<span class="comment">#</span>
<span class="comment"># aminoacids  A character string containing aminoacid sequence</span>
<span class="comment"># cutoff      An integer giving the minimum aminoacid length of valid ORFs</span>
<span class="comment">#</span>
<span class="comment"># value       A data.frame, coordinates refer to amino acid position</span>
<span class="comment">#</span>
<span class="symbol">findORF</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">aminoacids</span><span class="keyword">,</span> <span class="formalargs">cutoff</span> <span class="eqformalargs">=</span> <span class="number">100</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Use a regular expression to find all Start - Stop codon stretches</span>
  <span class="symbol">matches</span> <span class="assignement">&lt;-</span> <span class="functioncall">gregexpr</span><span class="keyword">(</span><span class="argument">pattern</span> <span class="argument">=</span> <span class="string">&ldquo;M(.*?)X&rdquo;</span><span class="keyword">,</span> <span class="argument">text</span> <span class="argument">=</span> <span class="symbol">aminoacids</span><span class="keyword">)</span>

  <span class="comment">#Extract match starting positions</span>
  <span class="symbol">startPositions</span> <span class="assignement">=</span> <span class="functioncall">as.vector</span><span class="keyword">(</span><span class="symbol">matches</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">)</span>

  <span class="comment">#Extract the match lengths</span>
  <span class="symbol">lengths</span> <span class="assignement">&lt;-</span> <span class="functioncall">attr</span><span class="keyword">(</span><span class="symbol">matches</span><span class="keyword">[[</span><span class="number">1</span><span class="keyword">]</span><span class="keyword">]</span><span class="keyword">,</span> <span class="string">&ldquo;match.length&rdquo;</span><span class="keyword">)</span>

  <span class="comment">#Extract the amino acid sequence of the matches</span>
  <span class="symbol">proteinSequence</span> <span class="assignement">&lt;-</span> <span class="functioncall">substring</span><span class="keyword">(</span> <span class="symbol">sampleAminoAcids</span><span class="keyword">,</span>
                                <span class="argument">first</span> <span class="argument">=</span> <span class="symbol">startPositions</span><span class="keyword">,</span>
                                <span class="argument">last</span>  <span class="argument">=</span> <span class="symbol">startPositions</span> <span class="keyword">+</span> <span class="symbol">lengths</span> <span class="keyword">-</span> <span class="number">1</span><span class="keyword">)</span>

  <span class="comment">#Create a new table to hold match information</span>
  <span class="symbol">preliminaryTable</span> <span class="assignement">&lt;-</span> <span class="functioncall">data.frame</span><span class="keyword">(</span> <span class="argument">startPosition</span>   <span class="argument">=</span> <span class="symbol">startPositions</span><span class="keyword">,</span>
                                  <span class="argument">length</span>          <span class="argument">=</span> <span class="symbol">lengths</span><span class="keyword">,</span>
                                  <span class="argument">proteinSequence</span> <span class="argument">=</span> <span class="symbol">proteinSequence</span>
                                  <span class="keyword">)</span>

  <span class="comment">#Filter the table with the cutoff value, return the result</span>
  <span class="functioncall">return</span><span class="keyword">(</span> <span class="symbol">preliminaryTable</span><span class="keyword">[</span><span class="symbol">lengths</span> <span class="keyword">&gt;=</span> <span class="symbol">cutoff</span><span class="keyword">,</span><span class="keyword">]</span> <span class="keyword">)</span>

<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="symbol">sampleAminoAcids</span> <span class="assignement">&lt;-</span> <span class="string">&ldquo;aaaaMbbbbXccccMddddddXeeee&rdquo;</span>
<span class="functioncall">findORF</span><span class="keyword">(</span><span class="symbol">sampleAminoAcids</span><span class="keyword">,</span> <span class="argument">cutoff</span> <span class="argument">=</span> <span class="number">1</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">  startPosition length proteinSequence
1             5      6          MbbbbX
2            15      8        MddddddX</pre></div><div class="source"><span class="functioncall">findORF</span><span class="keyword">(</span><span class="symbol">sampleAminoAcids</span><span class="keyword">,</span> <span class="argument">cutoff</span> <span class="argument">=</span> <span class="number">100</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] startPosition   length          proteinSequence
<0 rows> (or 0-length row.names)</pre></div><div class="source"><span class="functioncall">findORF</span><span class="keyword">(</span><span class="symbol">sampleAminoAcids</span><span class="keyword">,</span> <span class="argument">cutoff</span> <span class="argument">=</span> <span class="number">7</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">  startPosition length proteinSequence
2            15      8        MddddddX</pre></div></div></div>
</section>
<section><h2>FASTA file loader</h2>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Parses a sequence file in FASTA format</span>
<span class="comment">#</span>
<span class="comment"># fastaFile   A string giving the name of a fasta file to parse</span>
<span class="comment">#</span>
<span class="comment"># value       A string containing the parsed sequence</span>
<span class="comment">#</span>
<span class="symbol">loadFASTA</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">fastaFile</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Use readLines to load the given fasta file</span>
  <span class="symbol">lines</span> <span class="assignement">&lt;-</span> <span class="functioncall">readLines</span><span class="keyword">(</span><span class="symbol">fastaFile</span><span class="keyword">)</span>

  <span class="comment">#Trim out the header line</span>
  <span class="symbol">dnaLines</span> <span class="assignement">&lt;-</span> <span class="symbol">lines</span><span class="keyword">[</span><span class="number">2</span><span class="keyword">:</span><span class="functioncall">length</span><span class="keyword">(</span><span class="symbol">lines</span><span class="keyword">)</span><span class="keyword">]</span>

  <span class="comment">#Return a single string, using paste to collapse the vector of strings</span>
  <span class="functioncall">return</span><span class="keyword">(</span> <span class="functioncall">paste</span><span class="keyword">(</span><span class="symbol">dnaLines</span><span class="keyword">,</span> <span class="argument">collapse</span> <span class="argument">=</span> <span class="string">&ldquo;&rdquo;</span><span class="keyword">,</span> <span class="argument">sep</span> <span class="argument">=</span> <span class="string">&ldquo;&rdquo;</span><span class="keyword">)</span> <span class="keyword">)</span>

<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment">#This test assumes you&rsquo;ve saved &ldquo;chr1.fsa&rdquo; in the current working directory.</span>
<span class="comment">#This and subsequent tests are being run with a truncated version of chr1.fsa</span>
<span class="symbol">dna</span> <span class="assignement">&lt;-</span> <span class="functioncall">loadFASTA</span><span class="keyword">(</span><span class="string">&ldquo;chr01.fsa&rdquo;</span><span class="keyword">)</span>
<span class="functioncall">substr</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">,</span> <span class="number">10</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "CCACACCACA"</pre></div><div class="source"><span class="functioncall">nchar</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] 29880</pre></div></div></div>
</section>
<section><h2>Frame annotation</h2>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Annotates the ORFs found in a given frame of a dnaString</span>
<span class="comment">#</span>
<span class="comment"># dnaStrand   A string containing DNA sequence</span>
<span class="comment"># offset      The frame offset (0, 1, or 2)</span>
<span class="comment">#</span>
<span class="comment"># value       A data.frame.  Coordinates are relative to dnaStrand.</span>
<span class="comment">#</span>
<span class="symbol">annotateFrame</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">dnaStrand</span><span class="keyword">,</span> <span class="formalargs">offset</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Trim dnaStrand to given offset</span>
  <span class="symbol">searchFrame</span> <span class="assignement">&lt;-</span> <span class="functioncall">substr</span><span class="keyword">(</span><span class="symbol">dnaStrand</span><span class="keyword">,</span> <span class="number">1</span> <span class="keyword">+</span> <span class="symbol">offset</span><span class="keyword">,</span> <span class="functioncall">nchar</span><span class="keyword">(</span><span class="symbol">dnaStrand</span><span class="keyword">)</span><span class="keyword">)</span>

  <span class="comment">#Transcribe and translate to obtain an amino acid sequence</span>
  <span class="symbol">proteinFrame</span> <span class="assignement">&lt;-</span> <span class="functioncall">translate</span><span class="keyword">(</span> <span class="functioncall">transcribe</span><span class="keyword">(</span><span class="symbol">searchFrame</span><span class="keyword">)</span> <span class="keyword">)</span>

  <span class="comment">#Call findORF to get a table of ORFs (coordinates = amino acid sequence)</span>
  <span class="symbol">orfTable</span> <span class="assignement">&lt;-</span> <span class="functioncall">findORF</span><span class="keyword">(</span><span class="symbol">proteinFrame</span><span class="keyword">)</span>

  <span class="comment">#Update the coordinates in &lsquo;length&rsquo; and &lsquo;startPosition&rsquo; columns to match </span>
  <span class="comment">#nucleic acid coordinates in dnaStrand</span>
  <span class="symbol">orfTable</span><span class="keyword">$</span><span class="symbol">length</span>         <span class="assignement">&lt;-</span> <span class="symbol">orfTable</span><span class="keyword">$</span><span class="symbol">length</span> <span class="keyword">*</span> <span class="number">3</span>
  <span class="symbol">orfTable</span><span class="keyword">$</span><span class="symbol">startPosition</span>  <span class="assignement">&lt;-</span> <span class="keyword">(</span><span class="symbol">orfTable</span><span class="keyword">$</span><span class="symbol">startPosition</span> <span class="keyword">*</span> <span class="number">3</span><span class="keyword">)</span> <span class="keyword">+</span> <span class="symbol">offset</span>

  <span class="comment">#Return the table</span>
  <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">orfTable</span><span class="keyword">)</span>

<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="symbol">dna</span> <span class="assignement">&lt;-</span> <span class="functioncall">loadFASTA</span><span class="keyword">(</span><span class="string">&ldquo;chr01.fsa&rdquo;</span><span class="keyword">)</span>
<span class="symbol">frame1</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateFrame</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">,</span> <span class="number">0</span><span class="keyword">)</span>
<span class="symbol">frame1</span></div><div class="output"><pre class="knitr">    startPosition length proteinSequence
61          12048    381                
114         24480    402                
125         26736    426                </pre></div><div class="source"><span class="functioncall">nrow</span><span class="keyword">(</span><span class="symbol">frame1</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] 3</pre></div><div class="source"><span class="symbol">frame2</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateFrame</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">)</span>
<span class="functioncall">nrow</span><span class="keyword">(</span><span class="symbol">frame2</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] 2</pre></div><div class="source"><span class="symbol">frame3</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateFrame</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">,</span> <span class="number">3</span><span class="keyword">)</span>
<span class="functioncall">nrow</span><span class="keyword">(</span><span class="symbol">frame3</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] 3</pre></div></div></div>
</section>
<section><h2>Reverse complement</h2>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Calculates the reverse complement of a dnaStrand</span>
<span class="comment">#</span>
<span class="comment"># dnaStrand   A string containing the forward DNA sequence</span>
<span class="comment">#</span>
<span class="comment"># value       A string containing the reverse complement to dnaStrand</span>
<span class="comment">#</span>
<span class="symbol">reverseComplement</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">dnaStrand</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#First, reverse the sequence of dnaStrand</span>
  <span class="symbol">reversed</span> <span class="assignement">&lt;-</span> <span class="functioncall">reverseString</span><span class="keyword">(</span><span class="symbol">dnaStrand</span><span class="keyword">)</span>

  <span class="comment">#Replace bases with lower-case complements</span>
  <span class="symbol">complement</span> <span class="assignement">&lt;-</span> <span class="functioncall">sub</span><span class="keyword">(</span><span class="string">&ldquo;C&rdquo;</span><span class="keyword">,</span> <span class="string">&ldquo;g&rdquo;</span><span class="keyword">,</span>
                    <span class="functioncall">sub</span><span class="keyword">(</span><span class="string">&ldquo;G&rdquo;</span><span class="keyword">,</span><span class="string">&ldquo;c&rdquo;</span><span class="keyword">,</span>
                        <span class="functioncall">sub</span><span class="keyword">(</span><span class="string">&ldquo;A&rdquo;</span><span class="keyword">,</span><span class="string">&ldquo;t&rdquo;</span><span class="keyword">,</span>
                            <span class="functioncall">sub</span><span class="keyword">(</span><span class="string">&ldquo;T&rdquo;</span><span class="keyword">,</span> <span class="string">&ldquo;a&rdquo;</span><span class="keyword">,</span> <span class="symbol">reversed</span><span class="keyword">)</span>
                            <span class="keyword">)</span>
                        <span class="keyword">)</span>
                    <span class="keyword">)</span>

  <span class="comment">#Convert to all uppercase and return</span>
  <span class="functioncall">return</span><span class="keyword">(</span> <span class="functioncall">toupper</span><span class="keyword">(</span><span class="symbol">complement</span><span class="keyword">)</span> <span class="keyword">)</span>

<span class="keyword">}</span>

<span class="comment"># Reverses the characters in a string</span>
<span class="symbol">reverseString</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">a</span><span class="keyword">)</span> <span class="keyword">{</span>
  <span class="functioncall">paste</span><span class="keyword">(</span><span class="functioncall">rev</span><span class="keyword">(</span><span class="functioncall">substring</span><span class="keyword">(</span><span class="symbol">a</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span class="functioncall">nchar</span><span class="keyword">(</span><span class="symbol">a</span><span class="keyword">)</span><span class="keyword">,</span><span class="number">1</span><span class="keyword">:</span><span class="functioncall">nchar</span><span class="keyword">(</span><span class="symbol">a</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span><span class="argument">collapse</span><span class="argument">=</span><span class="string">&ldquo;&rdquo;</span><span class="keyword">)</span>
<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="functioncall">reverseString</span><span class="keyword">(</span><span class="string">&ldquo;ATGC&rdquo;</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "CGTA"</pre></div><div class="source"><span class="functioncall">reverseComplement</span><span class="keyword">(</span><span class="string">&ldquo;ATGC&rdquo;</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] "GCAT"</pre></div></div></div>
</section>
<section><h2>Annotation chromosome</h2>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Finds all open reading frames in the chromosome sequence in a FASTA file</span>
<span class="comment">#</span>
<span class="comment"># fastaFile   A string containing the name of a chromosome file in FASTA format</span>
<span class="comment">#</span>
<span class="comment"># value       A data.frame.  Coordinates are relative to DNA sequence in input.</span>
<span class="comment">#</span>
<span class="symbol">annotateChromosome</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">fastaFile</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Load the chromosome FASTA file</span>
  <span class="symbol">forwardStrand</span> <span class="assignement">&lt;-</span> <span class="functioncall">loadFASTA</span><span class="keyword">(</span><span class="symbol">fastaFile</span><span class="keyword">)</span>

  <span class="comment">#Get the forward frames</span>
  <span class="symbol">forwardFrames</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateStrand</span><span class="keyword">(</span><span class="symbol">forwardStrand</span><span class="keyword">)</span>

  <span class="comment">#Calculate the reverse complement strand</span>
  <span class="symbol">reverseStrand</span> <span class="assignement">&lt;-</span> <span class="functioncall">reverseComplement</span><span class="keyword">(</span><span class="symbol">forwardStrand</span><span class="keyword">)</span>

  <span class="comment">#The the reverse framse</span>
  <span class="symbol">reverseFrames</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateStrand</span><span class="keyword">(</span><span class="symbol">reverseStrand</span><span class="keyword">)</span>

  <span class="comment">#Correct the coordinates in the reverseFrames table (draw this to see why!)</span>
  <span class="symbol">strandLength</span> <span class="assignement">&lt;-</span> <span class="functioncall">nchar</span><span class="keyword">(</span><span class="symbol">forwardStrand</span><span class="keyword">)</span>
  <span class="symbol">reverseFrames</span><span class="keyword">$</span><span class="symbol">startPosition</span> <span class="assignement">&lt;-</span> <span class="symbol">strandLength</span> <span class="keyword">-</span> <span class="symbol">reverseFrames</span><span class="keyword">$</span><span class="symbol">startPosition</span> <span class="keyword">+</span> <span class="number">1</span>

  <span class="comment">#Merge the two tables, and return the result</span>
  <span class="functioncall">return</span><span class="keyword">(</span> <span class="functioncall">rbind</span><span class="keyword">(</span><span class="symbol">forwardFrames</span><span class="keyword">,</span> <span class="symbol">reverseFrames</span><span class="keyword">)</span> <span class="keyword">)</span>

<span class="keyword">}</span>

<span class="symbol">annotateStrand</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">dna</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Get ORF tables for each of the three forward frames</span>
  <span class="symbol">frame1</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateFrame</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">,</span> <span class="number">0</span><span class="keyword">)</span>
  <span class="symbol">frame2</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateFrame</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">,</span> <span class="number">1</span><span class="keyword">)</span>
  <span class="symbol">frame3</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateFrame</span><span class="keyword">(</span><span class="symbol">dna</span><span class="keyword">,</span> <span class="number">3</span><span class="keyword">)</span>

  <span class="comment">#Merge the frames</span>
  <span class="symbol">allFrames</span> <span class="assignement">&lt;-</span> <span class="functioncall">rbind</span><span class="keyword">(</span><span class="functioncall">rbind</span><span class="keyword">(</span><span class="symbol">frame1</span><span class="keyword">,</span> <span class="symbol">frame2</span><span class="keyword">)</span><span class="keyword">,</span> <span class="symbol">frame3</span><span class="keyword">)</span>

  <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">allFrames</span><span class="keyword">)</span>

<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="symbol">chr01</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateChromosome</span><span class="keyword">(</span><span class="string">&ldquo;chr01.fsa&rdquo;</span><span class="keyword">)</span>
<span class="functioncall">nrow</span><span class="keyword">(</span><span class="symbol">chr01</span><span class="keyword">)</span></div><div class="output"><pre class="knitr">[1] 9</pre></div><div class="source"><span class="symbol">chr01</span></div><div class="output"><pre class="knitr">     startPosition length proteinSequence
61           12048    381                
114          24480    402                
125          26736    426                
1              337    315                
45           10093    309                
611          12048    381                
1141         24480    402                
1251         26736    426                
119            825    318                </pre></div></div></div>
</section>
<section><h2>Annotate the whole genome</h2>

<p>This function implementation demonstrates the use of one new language construct (a for loop) and a few new functions.</p>

<p>Implementation:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment"># Loads all .fsa files in a given directory and saves an ORF annotation table</span>
<span class="comment">#</span>
<span class="comment"># </span>
<span class="symbol">annotateGenome</span> <span class="assignement">&lt;-</span> <span class="keyword">function</span><span class="keyword">(</span><span class="formalargs">fastaDirectory</span> <span class="eqformalargs">=</span> <span class="string">&ldquo;.&rdquo;</span><span class="keyword">,</span> <span class="formalargs">tableFile</span> <span class="eqformalargs">=</span> <span class="string">&ldquo;orftable.txt&rdquo;</span><span class="keyword">)</span> <span class="keyword">{</span>

  <span class="comment">#Load a list of all .fsa files found in fastaDirectory</span>
  <span class="symbol">fastaFiles</span> <span class="assignement">&lt;-</span> <span class="functioncall">list.files</span><span class="keyword">(</span><span class="symbol">fastaDirectory</span><span class="keyword">,</span> <span class="argument">pattern</span> <span class="argument">=</span> <span class="string">&ldquo;.fsa&rdquo;</span><span class="keyword">)</span>

  <span class="comment">#Create an empty data.frame to use to aggregate results</span>
  <span class="symbol">genomeORFs</span> <span class="assignement">&lt;-</span> <span class="functioncall">data.frame</span><span class="keyword">(</span> <span class="argument">file</span>            <span class="argument">=</span> <span class="functioncall">character</span><span class="keyword">(</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">,</span>
                            <span class="argument">startPosition</span>   <span class="argument">=</span> <span class="functioncall">numeric</span><span class="keyword">(</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">,</span>
                            <span class="argument">length</span>          <span class="argument">=</span> <span class="functioncall">numeric</span><span class="keyword">(</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">,</span>
                            <span class="argument">proteinSequence</span> <span class="argument">=</span> <span class="functioncall">character</span><span class="keyword">(</span><span class="number">0</span><span class="keyword">)</span><span class="keyword">)</span>

  <span class="comment">#For each file in fastaFiles</span>
  <span class="keyword">for</span> <span class="keyword">(</span><span class="symbol">fileName</span> <span class="keyword">in</span> <span class="symbol">fastaFiles</span><span class="keyword">)</span> <span class="keyword">{</span>

    <span class="functioncall">message</span><span class="keyword">(</span><span class="string">&ldquo;Annotating:&rdquo;</span><span class="keyword">,</span> <span class="symbol">fileName</span><span class="keyword">)</span>

    <span class="comment">#Generate the ORF table for this fasta file</span>
    <span class="symbol">chromosomeORFs</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateChromosome</span><span class="keyword">(</span><span class="symbol">fileName</span><span class="keyword">)</span>

    <span class="comment">#Add a column, recording the chromosome file used to generate these ORFs</span>
    <span class="symbol">chromosomeORFs</span><span class="keyword">$</span><span class="symbol">file</span> <span class="assignement">=</span> <span class="symbol">fileName</span>

    <span class="comment">#Merge with the aggregate table</span>
    <span class="symbol">genomeORFs</span> <span class="assignement">&lt;-</span> <span class="functioncall">rbind</span><span class="keyword">(</span><span class="symbol">genomeORFs</span><span class="keyword">,</span> <span class="symbol">chromosomeORFs</span><span class="keyword">)</span>

  <span class="keyword">}</span>

  <span class="comment">#Save genomeORFs</span>
  <span class="functioncall">write.table</span><span class="keyword">(</span><span class="symbol">genomeORFs</span><span class="keyword">,</span> <span class="symbol">tableFile</span><span class="keyword">,</span> <span class="argument">sep</span><span class="argument">=</span><span class="string">&ldquo;\t&rdquo;</span><span class="keyword">)</span>

  <span class="comment">#Return it for good measure</span>
  <span class="functioncall">return</span><span class="keyword">(</span><span class="symbol">genomeORFs</span><span class="keyword">)</span>

<span class="keyword">}</span></div></div></div>

<p>Tests:</p>

<div class="chunk"><div class="rcode"><div class="source"><span class="comment">#This test assumes you have .fsa files in the current working directory</span>
<span class="symbol">orfs</span> <span class="assignement">&lt;-</span> <span class="functioncall">annotateGenome</span><span class="keyword">(</span><span class="keyword">)</span></div><div class="message"><pre class="knitr">Annotating:chr01.fsa</pre></div><div class="source"><span class="symbol">orfs</span></div><div class="output"><pre class="knitr">     startPosition length proteinSequence      file
61           12048    381                 chr01.fsa
114          24480    402                 chr01.fsa
125          26736    426                 chr01.fsa
1              337    315                 chr01.fsa
45           10093    309                 chr01.fsa
611          12048    381                 chr01.fsa
1141         24480    402                 chr01.fsa
1251         26736    426                 chr01.fsa
119            825    318                 chr01.fsa</pre></div></div></div>
</section></section>
  </div>
  <!-- end of courser content -->

  <!-- JavaScript at the bottom for fast page loading -->
  <script src=js/vendor/jquery-1.7.2.min.js type="text/javascript"></script>
  <script src=js/plugins.js type="text/javascript"></script>
  <script src=js/main.js type="text/javascript"></script>
  <script src=js/vendor/reveal.js type="text/javascript"></script>

</body>
</html>
